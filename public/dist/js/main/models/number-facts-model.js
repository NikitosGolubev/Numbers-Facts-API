"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var NumberFactsModel=function(){function e(){_classCallCheck(this,e),this.factNumberObservers=[],this.factCategoryObservers=[],this.factNumber=this.getStarterFactNumberFromDOM(),this.maxNumberLen=4,this.factCategory=this.getCurrentFactCategoryDOM()}return _createClass(e,[{key:"registerFactNumberObserver",value:function(e){this.factNumberObservers.push(e)}},{key:"removeFactNumberObserver",value:function(e){var t=this.factNumberObservers.indexOf(e);this.factNumberObservers.splice(t,1)}},{key:"notifyFactNumberObservers",value:function(e){Number.isInteger(+e.number)&&(e.number=this.convertToNumberWithForwardZeros(e.number));for(var t=0;t<this.factNumberObservers.length;t++)this.factNumberObservers[t].updateFactNumber(e)}},{key:"getFactNumber",value:function(){return this.factNumber}},{key:"setFactNumber",value:function(e){console.log(e),this.factNumber=this.alignFactNumberWithLimit(e),this.getFactWithConcreteNumber()}},{key:"getFactWithRandomNumber",value:function(){var t=this,e="api/".concat(this.factCategory);this.getFactData(e).then(function(e){return t.factNumber=e.number})}},{key:"getFactWithConcreteNumber",value:function(){var e="api/".concat(this.factCategory,"/").concat(this.factNumber);this.getFactData(e)}},{key:"getFactData",value:function(e){var t=this;return fetch(e).then(function(e){return e.json()}).then(function(e){return t.notifyFactNumberObservers(e),e}).catch(function(e){return console.log(e)})}},{key:"registerFactCategoryObserver",value:function(e){this.factCategoryObservers.push(e)}},{key:"removeFactCategoryObserver",value:function(e){var t=this.factCategoryObservers.indexOf(e);this.factCategoryObservers.splice(t,1)}},{key:"notifyFactCategoryObservers",value:function(e){for(var t=0;t<this.factCategoryObservers.length;t++)this.factCategoryObservers[t].updateFactCategory(e)}},{key:"getCurrentFactCategoryDOM",value:function(){return document.querySelector(".js-current-fact-category").getAttribute("current-fact-category")}},{key:"chooseCategoryAndGetFact",value:function(e){var t=e.getAttribute("fact-category");t!==this.factCategory&&this.setCurrentFactCategory(t),this.getFactWithRandomNumber()}},{key:"setCurrentFactCategory",value:function(e){this.factCategory=e,this.notifyFactCategoryObservers(e)}},{key:"increaseFactNumber",value:function(){this.setFactNumber(++this.factNumber)}},{key:"decreaseFactNumber",value:function(){this.setFactNumber(--this.factNumber)}},{key:"validateFactNumField",value:function(e){var t=e.target,r=t.value.search(/\D/i);-1<r&&(t.value=t.value.substr(0,r)),t.value.length>this.maxNumberLen&&(t.value=t.value.substr(0,4))}},{key:"setTypedFactNumber",value:function(e){if(""!==e.target.value){var t=+e.target.value;this.setFactNumber(t),e.target.value="",document.activeElement.blur()}}},{key:"getStarterFactNumberFromDOM",value:function(){var e=document.querySelector(".js-fact-number").innerText;return this.convertToNumberWithoutForwardZeros(e)}},{key:"convertToNumberWithoutForwardZeros",value:function(e){return+e}},{key:"convertToNumberWithForwardZeros",value:function(e){var t=""+e,r=t.length,a=this.maxNumberLen-r;if(0<a)for(var u=0;u<a;u++)t="0"+t;return t}},{key:"alignFactNumberWithLimit",value:function(e){if((""+e).length>this.maxNumberLen)e=0;else if(e<0){for(var t="",r=0;r<this.maxNumberLen;r++)t+="9";e=+t}return e}}]),e}();